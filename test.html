<!DOCTYPE html>
<head>
  <meta charset="utf-8">
  <script src="https://d3js.org/d3.v4.min.js"></script>
  <style>
    body {
      font-family: sans-serif;
      font-size: 4em;
      margin: 1em;
    }
  </style>
</head>

<body>
  
  <p>Temperature in London</p>
  <p id="temp-c">loading...</p>
  <p id="temp-f"></p>
  
  <script>
    var url = "https://api.openweathermap.org/data/2.5/weather?q=London,uk&appid=a3d9b50b2022aaff3f6b7eb24288e5c8";
    var format = d3.format(".2f");
    
    function update(){
      d3.json(url, function (data){
        var kelvin = data.main.temp;
        var tempC = format(celcuis(kelvin));
        var tempF = format(fahrenheit(kelvin));
        d3.select("#temp-c").text(tempC + " 째C");
        d3.select("#temp-f").text(tempF + " 째F");
        var text = "Temperature in London: " + tempC + " 째C / " + tempF + " 째F";
        var blob = new Blob([text], {type: "text/plain;charset=utf-8"});
        var filename = "temperature.txt";
        if (window.navigator.msSaveOrOpenBlob) {
          window.navigator.msSaveOrOpenBlob(blob, filename);
        } else {
          var a = document.createElement("a");
          var url = URL.createObjectURL(blob);
          a.href = url;
          a.download = filename;
          document.body.appendChild(a);
          a.click();
          setTimeout(function() {
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);  
          }, 0); 
        }
      });
    }
    
    function celcuis(kelvin){ return kelvin - 273.15; }
    function fahrenheit(kelvin){ return celcuis(kelvin) * 9/5 + 32; }
    
    update();
    
    var fiveMinutes = 1000 * 60 * 5;
    setInterval(update, fiveMinutes);
    
  </script>
</body>
